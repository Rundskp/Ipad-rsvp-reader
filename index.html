<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0c10" />
  <title>RSVP Reader</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="stylesheet" href="./style.css" />
  <link rel="icon" href="data:,">
</head>

<body>
  <!-- Topbar -->
<header class="topbar">
  <div class="topLeft"></div>

  <div class="topLogo" aria-hidden="true">
    </div>

  <label class="btn topBtn" id="btnFileLabel" for="file" title="Datei laden">Datei laden</label>
  <input id="file" type="file" accept=".epub,.txt" hidden />

  <div class="topActions">
    <button id="btnSidebar"  class="btn ghost topBtn" data-panel="sidebar"  title="Kapitel / Lesezeichen">‚ò∞</button>
    <button id="btnHeader"   class="btn ghost topBtn" data-panel="header"   title="Cover/Titel">üõà</button>
    <div class="glassesWrap">
      <svg class="glassesMark" xmlns="http://www.w3.org/2000/svg"
           viewBox="0 0 2499 391" preserveAspectRatio="xMidYMid meet">
      <defs>
        <!-- Chrome / Metall: sichtbar auch klein -->
              <linearGradient id="metalChrome" x1="0%" x2="0%" y1="0%" y2="100%">
  <!-- helles Top-Highlight -->
  <stop offset="0%"    stop-color="#f9fbfe"/>
  <stop offset="9%"    stop-color="#d7dde4"/>

  <!-- dunklerer ‚ÄúBody‚Äù -->
  <stop offset="22%"   stop-color="#616a74"/>

  <!-- schmale, knackige Reflexzone (statt dicker Wei√ü-Balken) -->
  <stop offset="34%"   stop-color="#f2f5f9"/>
  <stop offset="41%"   stop-color="#9aa3ad"/>
  <stop offset="47%"   stop-color="#f7f9fc"/>

  <!-- untere H√§lfte: bleibt sichtbar, aber nicht grau-plastik -->
  <stop offset="62%"   stop-color="#2b323a"/>
  <stop offset="78%"   stop-color="#7c8793"/>
  <stop offset="100%"  stop-color="#eef2f7"/>
</linearGradient>

        <!-- Kanten-Glanz: horizontaler Sheen -->
        <linearGradient id="edgeSheen" x1="0%" x2="100%" y1="0%" y2="0%">
          <stop offset="0%" stop-color="#ffffff" stop-opacity="0"></stop>
          <stop offset="18%" stop-color="#ffffff" stop-opacity="0.18"></stop>
          <stop offset="50%" stop-color="#ffffff" stop-opacity="0.55"></stop>
          <stop offset="82%" stop-color="#ffffff" stop-opacity="0.16"></stop>
          <stop offset="100%" stop-color="#ffffff" stop-opacity="0"></stop>
        </linearGradient>

        <!-- Optional: sehr dezenter Schatten, wirkt edler auf dunklem Header -->
        <filter id="softShadow" x="-20%" y="-40%" width="140%" height="200%">
          <feDropShadow dx="0" dy="6" stdDeviation="6" flood-color="#000000" flood-opacity="0.45"></feDropShadow>
        </filter>
      </defs>

      <!-- 1) Hauptform: Metall -->
      <path fill-rule="evenodd" fill="url(#metalChrome)" filter="url(#softShadow)" d="M802.1000,0.1000 C858.937,-0.082 913.163,11.196 962.1000,23.1000 C1058.686,48.584 1150.889,72.931 1248.000,88.1000 C1283.976,94.953 1356.859,69.186 1387.000,60.1000 C1457.476,41.860 1527.512,29.361 1600.1000,13.000 C1624.664,10.334 1648.336,7.666 1672.000,4.1000 C1709.147,-1.204 1779.459,19.174 1812.000,26.1000 C1850.330,33.999 1888.670,41.001 1926.1000,47.1000 C1998.051,65.532 2063.022,77.572 2132.1000,94.1000 C2195.994,105.999 2259.006,117.001 2322.000,127.1000 C2352.022,134.392 2385.552,134.987 2407.000,150.000 C2436.514,170.659 2445.076,210.723 2463.000,242.1000 C2473.052,261.101 2511.184,318.985 2494.000,346.000 C2470.354,383.174 2394.293,338.774 2379.000,318.000 C2352.208,281.606 2353.054,221.646 2315.1000,195.1000 C2289.858,177.906 2221.901,181.683 2183.1000,174.1000 C2077.011,160.668 1969.989,146.332 1863.000,131.1000 C1835.584,126.749 1742.131,110.560 1725.1000,119.1000 C1707.736,173.747 1694.578,237.054 1677.1000,291.000 C1669.521,318.590 1665.508,357.268 1644.1000,373.000 C1619.214,392.781 1517.271,393.231 1474.000,386.000 C1435.396,379.549 1395.300,384.660 1370.1000,365.000 C1361.700,357.475 1356.408,343.479 1350.000,333.000 C1329.926,300.171 1308.749,266.558 1289.1000,232.000 C1281.340,216.038 1272.934,181.797 1253.1000,176.1000 C1225.121,169.684 1214.314,212.683 1207.000,228.1000 C1194.323,257.280 1138.861,356.427 1116.1000,370.000 C1092.851,384.993 1056.112,380.601 1021.1000,386.000 C1001.516,389.242 972.380,391.499 951.000,388.000 C914.050,381.954 874.585,390.192 850.1000,372.000 C833.187,358.261 829.504,326.911 822.000,303.000 C813.001,271.337 803.999,239.663 794.1000,207.1000 C786.736,175.784 783.507,139.089 767.000,114.1000 C742.309,112.429 715.667,119.588 692.1000,124.000 C668.669,127.333 644.331,130.667 619.1000,133.1000 C531.342,145.999 442.658,158.001 353.1000,169.1000 C314.671,175.333 275.329,180.667 236.000,185.1000 C219.807,189.173 201.476,186.907 188.1000,194.000 C147.670,217.498 146.273,282.799 119.000,321.000 C110.692,332.638 91.034,341.245 77.1000,348.000 C54.393,360.235 14.729,372.089 2.1000,339.000 C-5.641,314.622 10.962,299.343 17.1000,284.1000 C38.656,242.901 52.784,180.969 88.1000,154.000 C127.709,125.174 238.248,121.645 296.1000,107.1000 C406.447,82.581 521.076,61.667 630.1000,33.1000 C688.328,23.001 745.672,11.999 802.1000,0.1000 ZM1541.1000,91.1000 C1520.669,93.1000 1499.331,96.000 1478.000,98.000 C1433.960,106.018 1361.899,114.339 1329.000,134.1000 C1316.256,177.425 1338.706,200.682 1351.1000,227.000 C1364.130,251.014 1381.368,298.214 1401.000,313.000 C1439.133,341.720 1564.735,345.792 1604.000,315.000 C1615.697,305.827 1617.271,276.958 1621.000,260.000 C1624.487,244.143 1633.457,232.564 1637.000,218.1000 C1637.000,210.667 1637.000,202.332 1637.000,194.000 C1638.1000,180.668 1641.000,167.332 1643.000,154.000 C1645.996,136.369 1645.313,102.760 1633.1000,95.1000 C1627.515,92.428 1558.392,91.944 1541.1000,91.1000 ZM899.000,100.000 C883.246,106.152 868.783,102.256 860.1000,115.1000 C851.347,133.046 861.395,155.456 857.1000,176.1000 C855.664,191.825 885.145,303.774 892.1000,313.000 C903.089,324.849 930.546,330.255 947.1000,334.000 C970.454,338.818 1001.669,333.336 1020.000,329.000 C1041.945,323.809 1067.911,327.859 1087.1000,317.000 C1109.380,305.443 1135.184,250.142 1145.000,225.000 C1150.691,210.423 1191.016,151.902 1161.1000,131.1000 C1150.484,125.520 1136.933,125.135 1123.000,120.1000 C1061.360,102.708 981.793,100.153 899.000,100.000 Z"></path>
      <path fill="none" stroke="rgba(255,255,255,0.18)" stroke-width="3"
      stroke-linejoin="round" stroke-linecap="round"
      d="M802.1000,0.1000 C858.937,-0.082 913.163,11.196 962.1000,23.1000 C1058.686,48.584 1150.889,72.931 1248.000,88.1000 C1283.976,94.953 1356.859,69.186 1387.000,60.1000 C1457.476,41.860 1527.512,29.361 1600.1000,13.000 C1624.664,10.334 1648.336,7.666 1672.000,4.1000 C1709.147,-1.204 1779.459,19.174 1812.000,26.1000 C1850.330,33.999 1888.670,41.001 1926.1000,47.1000 C1998.051,65.532 2063.022,77.572 2132.1000,94.1000 C2195.994,105.999 2259.006,117.001 2322.000,127.1000 C2352.022,134.392 2385.552,134.987 2407.000,150.000 C2436.514,170.659 2445.076,210.723 2463.000,242.1000 C2473.052,261.101 2511.184,318.985 2494.000,346.000 C2470.354,383.174 2394.293,338.774 2379.000,318.000 C2352.208,281.606 2353.054,221.646 2315.1000,195.1000 C2289.858,177.906 2221.901,181.683 2183.1000,174.1000 C2077.011,160.668 1969.989,146.332 1863.000,131.1000 C1835.584,126.749 1742.131,110.560 1725.1000,119.1000 C1707.736,173.747 1694.578,237.054 1677.1000,291.000 C1669.521,318.590 1665.508,357.268 1644.1000,373.000 C1619.214,392.781 1517.271,393.231 1474.000,386.000 C1435.396,379.549 1395.300,384.660 1370.1000,365.000 C1361.700,357.475 1356.408,343.479 1350.000,333.000 C1329.926,300.171 1308.749,266.558 1289.1000,232.000 C1281.340,216.038 1272.934,181.797 1253.1000,176.1000 C1225.121,169.684 1214.314,212.683 1207.000,228.1000 C1194.323,257.280 1138.861,356.427 1116.1000,370.000 C1092.851,384.993 1056.112,380.601 1021.1000,386.000 C1001.516,389.242 972.380,391.499 951.000,388.000 C914.050,381.954 874.585,390.192 850.1000,372.000 C833.187,358.261 829.504,326.911 822.000,303.000 C813.001,271.337 803.999,239.663 794.1000,207.1000 C786.736,175.784 783.507,139.089 767.000,114.1000 C742.309,112.429 715.667,119.588 692.1000,124.000 C668.669,127.333 644.331,130.667 619.1000,133.1000 C531.342,145.999 442.658,158.001 353.1000,169.1000 C314.671,175.333 275.329,180.667 236.000,185.1000 C219.807,189.173 201.476,186.907 188.1000,194.000 C147.670,217.498 146.273,282.799 119.000,321.000 C110.692,332.638 91.034,341.245 77.1000,348.000 C54.393,360.235 14.729,372.089 2.1000,339.000 C-5.641,314.622 10.962,299.343 17.1000,284.1000 C38.656,242.901 52.784,180.969 88.1000,154.000 C127.709,125.174 238.248,121.645 296.1000,107.1000 C406.447,82.581 521.076,61.667 630.1000,33.1000 C688.328,23.001 745.672,11.999 802.1000,0.1000 ZM1541.1000,91.1000 C1520.669,93.1000 1499.331,96.000 1478.000,98.000 C1433.960,106.018 1361.899,114.339 1329.000,134.1000 C1316.256,177.425 1338.706,200.682 1351.1000,227.000 C1364.130,251.014 1381.368,298.214 1401.000,313.000 C1439.133,341.720 1564.735,345.792 1604.000,315.000 C1615.697,305.827 1617.271,276.958 1621.000,260.000 C1624.487,244.143 1633.457,232.564 1637.000,218.1000 C1637.000,210.667 1637.000,202.332 1637.000,194.000 C1638.1000,180.668 1641.000,167.332 1643.000,154.000 C1645.996,136.369 1645.313,102.760 1633.1000,95.1000 C1627.515,92.428 1558.392,91.944 1541.1000,91.1000 ZM899.000,100.000 C883.246,106.152 868.783,102.256 860.1000,115.1000 C851.347,133.046 861.395,155.456 857.1000,176.1000 C855.664,191.825 885.145,303.774 892.1000,313.000 C903.089,324.849 930.546,330.255 947.1000,334.000 C970.454,338.818 1001.669,333.336 1020.000,329.000 C1041.945,323.809 1067.911,327.859 1087.1000,317.000 C1109.380,305.443 1135.184,250.142 1145.000,225.000 C1150.691,210.423 1191.016,151.902 1161.1000,131.1000 C1150.484,125.520 1136.933,125.135 1123.000,120.1000 C1061.360,102.708 981.793,100.153 899.000,100.000 Z" />

      <!-- 2) Glanzkante oben dr√ºber (macht den ‚ÄúEffekt‚Äù, ohne Form zu √§ndern) -->
      <path fill-rule="evenodd" fill="none" stroke="url(#edgeSheen)" stroke-width="10" stroke-linecap="round" stroke-linejoin="round" d="M802.1000,0.1000 C858.937,-0.082 913.163,11.196 962.1000,23.1000 C1058.686,48.584 1150.889,72.931 1248.000,88.1000 C1283.976,94.953 1356.859,69.186 1387.000,60.1000 C1457.476,41.860 1527.512,29.361 1600.1000,13.000 C1624.664,10.334 1648.336,7.666 1672.000,4.1000 C1709.147,-1.204 1779.459,19.174 1812.000,26.1000 C1850.330,33.999 1888.670,41.001 1926.1000,47.1000 C1998.051,65.532 2063.022,77.572 2132.1000,94.1000 C2195.994,105.999 2259.006,117.001 2322.000,127.1000 C2352.022,134.392 2385.552,134.987 2407.000,150.000"></path>
          </svg>
    </div>
  </div>

  <div class="topActions">
    <label class="btn topBtn" id="btnFileLabel" for="file" title="Datei laden">Datei laden</label>
    <input id="file" type="file" accept=".epub,.txt" hidden />

    <button id="btnSidebar"  class="btn ghost topBtn" data-panel="sidebar"  title="Kapitel / Lesezeichen">‚ò∞</button>
    <button id="btnHeader"   class="btn ghost topBtn" data-panel="header"   title="Cover/Titel">üõà</button>
    <button id="btnSettings" class="btn ghost topBtn" data-panel="settings" title="Einstellungen">‚öôÔ∏é</button>
    <button id="btnHelp"     class="btn ghost topBtn" data-panel="help"     title="Hilfe">?</button>
    <button id="btnDonate"   class="btn ghost topBtn" data-panel="donate"   title="Spenden">‚òïÔ∏è</button>
    <button id="btnShelf"    class="btn ghost topBtn" data-panel="shelf"    title="Bibliothek">üìö</button>
  </div>

  <div id="status" class="statusSr" aria-live="polite"></div>
</header>

  <!-- Optional header info (cover + title) -->
  <section id="headerInfo" class="headerInfoBar hidden">
    <div class="headerInfoInner">
      <img id="coverImg" class="cover" alt="Cover" />
      <div class="meta">
        <div id="bookTitle" class="bookTitle">‚Äî</div>
        <div id="bookAuthor" class="bookAuthor">‚Äî</div>
        <div class="metaRow">
          <span class="pill"><b>Fortschritt</b> <span id="prog">0%</span></span>
          <span class="pill"><b>WPM</b> <span id="wpmVal">360</span></span>
          <span class="pill"><b>Kapitel</b> <span id="chapVal">‚Äî</span></span>
        </div>
      </div>
    </div>
  </section>

  <!-- Main -->
  <main class="wrap">
    <section class="card">
      <div class="player">
        <div class="display" id="display">
          <span class="word" id="word">‚Äî</span>
        </div>

        <div class="transport">
          <button id="btnBack" class="btn ghost" disabled>‚üµ</button>
          <button id="btnPlay" class="btn primary" disabled>Play</button>
          <button id="btnFwd" class="btn ghost" disabled>‚ü∂</button>
          <button id="btnBookmark" class="btn ghost" disabled>üîñ</button>
          <button id="btnReset" class="btn ghost" disabled>Reset</button>
        </div>

        <div class="scrub">
          <input id="seek" type="range" min="0" max="0" value="0" disabled>
          <div class="hint">
            <span id="pos">0</span> / <span id="total">0</span> W√∂rter
            <span class="sep">‚Ä¢</span>
            Tippen: links zur√ºck, Mitte Play/Pause, rechts vor
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Sidebar -->
  <aside id="sidebar" class="panel panel-left sidebar hidden" data-panel-id="sidebar">
    <div class="sidebarHead">
      <div class="sidebarTitle">Kapitel & Lesezeichen</div>
      <button id="btnSidebarCloseMobile" class="btn ghost mobile-only" type="button" title="Schlie√üen">‚úï</button>
    </div>

    <div class="tabs">
      <button id="tabToc" class="tab active" type="button">Kapitel</button>
      <button id="tabMarks" class="tab" type="button">Lesezeichen</button>
    </div>

    <div class="sidebarBody">
      <div class="sidebarScroll">
        <div id="tocPane" class="pane">
          <div id="tocList" class="list muted">Noch kein Buch geladen.</div>
        </div>

        <div id="marksPane" class="pane hidden">
          <div id="marksList" class="list muted">Keine Lesezeichen.</div>
        </div>
      </div>
      <div class="sidebarGap" aria-hidden="true"></div>
    </div>
  </aside>

  <!-- Settings panel -->
  <div id="settingsModal" class="popoverPanel hidden" data-panel-id="settings">
    <div class="dialog">
      <div class="dialogHead">
        <div class="dialogTitle">Einstellungen</div>
        <button id="btnSettingsClose" class="btn ghost" type="button" title="Schlie√üen">‚úï</button>
      </div>

      <div class="controls">
        <div class="control">
          <label class="labelRow">
            <span>Geschwindigkeit (WPM)</span>
            <span class="pill small"><span id="wpmSettingVal">360</span> WPM</span>
          </label>
          <input id="wpm" type="range" min="120" max="900" step="10" value="360">
        </div>

        <div class="control">
          <label>Chunk (W√∂rter pro Anzeige)</label>
          <input id="chunk" type="range" min="1" max="6" step="1" value="1">
          <div class="hint"><span id="chunkVal">1</span> Wort/W√∂rter</div>
        </div>

        <div class="control">
          <label class="check">
            <input id="orp" type="checkbox" checked>
            ORP-Highlight
          </label>
          <label class="check">
            <input id="punct" type="checkbox" checked>
            Extra-Pause bei Satzzeichen
          </label>
        </div>

        <div class="control">
          <label>Satzzeichen-Pause (ms)</label>
          <input id="punctMs" type="range" min="0" max="500" step="25" value="200">
          <div class="hint"><span id="punctVal">200</span> ms</div>
        </div>

        <hr class="hr">

        <div class="control">
          <label class="check">
            <input id="stopChapter" type="checkbox">
            Auto-Stop am Kapitelende (nicht mitten im Satz)
          </label>
          <label class="check">
            <input id="stopWordsOn" type="checkbox">
            Auto-Stop nach W√∂rtern
          </label>
          <input id="stopWords" type="number" min="100" step="100" value="2000" class="num" />
          <div class="hint">Stoppt erst nach Satzende (., !, ?).</div>
        </div>

        <div class="control">
          <label class="check">
            <input id="stopMinsOn" type="checkbox">
            Auto-Stop nach Minuten
          </label>
          <input id="stopMins" type="number" min="1" step="1" value="10" class="num" />
        </div>

        <div class="rowBtns">
          <button id="btnSaveSettings" class="btn" type="button">Speichern</button>
          <button id="btnLoadSettings" class="btn ghost" type="button">Laden</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Help modal -->
  <div id="helpBackdrop" class="popoverPanel hidden" data-panel-id="help">
    <div class="dialog">
      <div class="dialogHead">
        <div class="dialogTitle">‚ùì Hilfe</div>
        <button id="btnHelpClose" class="btn ghost" type="button" title="Schlie√üen">‚úï</button>
      </div>
      <div id="helpBody" class="helpBody"></div>
    </div>
  </div>

  <!-- Donate modal -->
  <div id="donateBackdrop" class="popoverPanel hidden" data-panel-id="donate">
    <div class="dialog">
      <div class="dialogHead">
        <div class="dialogTitle">‚òïÔ∏è Spenden</div>
        <button id="btnDonateClose" class="btn ghost" type="button" title="Schlie√üen">‚úï</button>
      </div>

      <p class="small">
        Falls dir mein Tool gef√§llt und du mich unterst√ºtzen willst:
        <b>PayPal</b> oder <b>Bitcoin</b> ‚Äì super einfach. ‚ù§Ô∏è
      </p>

      <div class="ctaGrid">
        <div class="payCard">
          <div class="muted"><b>PayPal</b></div>

          <a class="payBtnBig" href="https://paypal.me/rophko" target="_blank" rel="noopener">
            <img class="paypalImg" alt="PayPal" src="data:image/svg+xml;utf8,
              <svg xmlns='http://www.w3.org/2000/svg' width='420' height='140' viewBox='0 0 420 140'>
                <rect width='420' height='140' rx='24' fill='%23f5f7ff'/>
                <text x='50%25' y='55%25' text-anchor='middle' font-family='Arial' font-size='44' fill='%23003087'>PayPal</text>
                <text x='50%25' y='80%25' text-anchor='middle' font-family='Arial' font-size='20' fill='%23003087'>Jetzt spenden</text>
              </svg>"/>
          </a>

          <div class="small muted">Tippen ‚Üí PayPal √∂ffnet direkt.</div>

          <div class="row" style="margin-top:6px;">
            <button id="btnPaypalQR" type="button" class="btn ghost">QR anzeigen</button>
          </div>

          <div id="paypalQrWrap" style="display:none; margin-top:8px;">
            <img id="paypalQrImg" class="qrImg" alt="PayPal QR" />
            <div class="small muted" style="margin-top:6px;">Scan ‚Üí PayPal-Link √∂ffnet.</div>
            <div id="paypalQrHint" class="small muted" style="margin-top:6px;"></div>
          </div>
        </div>

        <div class="payCard">
          <div class="muted"><b>Bitcoin</b></div>

          <div class="addrBox">
            <div class="small muted">Adresse</div>
            <div id="btcAddr" class="mono"></div>
            <div class="row" style="margin-top:6px;">
              <button id="btnCopyBtc" type="button" class="btn">Kopieren</button>
              <button id="btnBtcQR" type="button" class="btn ghost">QR anzeigen</button>
            </div>
          </div>

          <div id="btcQrWrap" style="display:none; margin-top:8px;">
            <img id="btcQrImg" class="qrImg" alt="Bitcoin QR" />
            <div class="small muted" style="margin-top:6px;">Scan ‚Üí Wallet √∂ffnet (bitcoin:).</div>
            <div id="btcQrHint" class="small muted" style="margin-top:6px;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom shelf -->
  <footer id="shelf" class="shelf panel panel-bottom hidden" data-panel-id="shelf">
    <div class="shelfHead">
      <div class="shelfTitle">Bibliothek</div>

        <div class="row">
        <button id="btnSelectAll" class="btn ghost" type="button">Alle ausw√§hlen</button>
  
        <button id="btnExportAll" class="btn" type="button">Export: Alles</button>
        <button id="btnExportSelected" class="btn ghost" type="button">Export: Auswahl</button>
  ...
          
          <button id="btnDeleteSelected" class="btn ghost" type="button" style="color: #ff4d4d; border-color: rgba(255,77,77,0.2);">Auswahl l√∂schen</button>

          <label class="btn ghost" style="margin:0;">
            Import
            <input id="importFile" type="file" accept=".json,application/json" hidden />
          </label>
        </div>
    </div>

    <div id="shelfList" class="shelfList muted">Noch keine B√ºcher gespeichert.</div>
  </footer>

  <div id="toast" class="toast hidden"></div>

  <!-- libs: ORDER MATTERS -->
  <script src="./lib/jszip.min.js"></script>
  <script src="./lib/epub.min.js"></script>

  <!-- app -->
  <script src="./app.js?v=fix2"></script>

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js").catch(console.error);
    }
  </script>
</body>
</html>


